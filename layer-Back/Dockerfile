# ‚öôÔ∏è –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑
FROM python:3.11-slim

# —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è psycopg2, cryptography, pymupdf
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc build-essential libffi-dev libpq-dev libmupdf-dev wget \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∫–µ—à–∏—Ä—É–µ—Ç—Å—è)
COPY requirements.txt ./requirements.txt
RUN pip install --no-cache-dir -r requirements.txt

# —Ç–µ–ø–µ—Ä—å –∫–æ–¥
COPY . .

# –Ω–∞ –≤—Å—è–∫–∏–π ‚Äî –≤—ã—Å—Ç–∞–≤–∏–º PYTHONPATH
ENV PYTHONPATH=/app \
    PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1

# üëá –í–ê–ñ–ù–û: –µ—Å–ª–∏ –≤–∞—à main –ª–µ–∂–∏—Ç –≤ app/main.py ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º app.main:app
# –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–∞ –∫–æ—Ä–Ω–µ layer-Back/main.py ‚Äî –º–µ–Ω—è–π—Ç–µ –Ω–∞ main:app
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
