# ‚öôÔ∏è –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑
FROM python:3.11-slim

# üìç –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# ‚úÖ –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏
COPY requirements.txt .

# üß± –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω–æ ‚Äî –±—É–¥–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å—Å—è
RUN apt-get update && apt-get install -y \
    gcc \
    build-essential \
    libffi-dev \
    libpq-dev \
    libmupdf-dev \
    && pip install --no-cache-dir -r requirements.txt \
    && apt-get remove -y gcc build-essential \
    && apt-get autoremove -y \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# ‚úÖ –¢–æ–ª—å–∫–æ —Ç–µ–ø–µ—Ä—å –∫–æ–ø–∏—Ä—É–µ–º –æ—Å—Ç–∞–≤—à–∏–π—Å—è –∫–æ–¥ (–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è —á–∞—Å—Ç–æ)
COPY . .

# üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
